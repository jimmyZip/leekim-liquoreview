<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="AlcoholMapper">
	<select id="alcoholLst" resultType="Alcohol">
		/*알콜 및 상위, 하위 카테고리 전체 조회, 이양원*/
		SELECT  /*alcoholLst*/
			  A.ALCOHOL_ID
			, (SELECT TOPCATEGORY_ID FROM TOPCATEGORY WHERE 1=1 AND TOPCATEGORY_ID = B.TOPCATEGORY_ID) AS TOPCATEGORY_ID
			, (SELECT NAME  FROM TOPCATEGORY WHERE 1=1 AND TOPCATEGORY_ID = B.TOPCATEGORY_ID) AS TOP_NM
			, B.SUBCATEGORY_ID
			, B.NAME AS SUB_NM
			, A.NAME AS ALCOHOL_NM
			, A.DEGREE AS ALC_DEGREE
			, A.DETAIL AS ALC_DETAIL
			, A.REGDATE
			, A.LAST_MODI_YMD
		  FROM ALCOHOL A
				 , SUBCATEGORY B
		  WHERE 1=1
			  AND A.SUBCATEGORY_ID = B.SUBCATEGORY_ID
		  ORDER BY ALCOHOL_ID
	</select>
	
	<select id="topLst" resultType="Alcohol">
		/*주류 상위 카테고리 조회, 이양원*/
		SELECT  /*topLst*/
			  TOPCATEGORY_ID
			, NAME AS TOP_NM
		  FROM TOPCATEGORY
		  ORDER BY TOPCATEGORY_ID
	</select>
	
	<select id="subLst" parameterType="map" resultType="Alcohol">
		/*주류 하위 카테고리 조회, 이양원*/
		SELECT  /*subLst*/
			  SUBCATEGORY_ID
		    , TOPCATEGORY_ID
			, NAME AS SUB_NM
		  FROM SUBCATEGORY
		  WHERE 1=1
			  AND TOPCATEGORY_ID = #{TOPCATEGORY_ID}
	</select>
	
	<insert id="topCateReg" parameterType="Alcohol">
		/*상위 카테고리 등록, 이양원*/
		INSERT  /*topCateReg*/
		    INTO TOPCATEGORY(
				  NAME
				, REGDATE
				, LAST_MODI_YMD
			)
			VALUES(
				  #{TOPCATEGORY_ID}
				, SYSDATE()
				, SYSDATE()
			)
	</insert>
	
	<insert id="subCateReg" parameterType="Alcohol">
		/*하위 카테고리 등록, 이양원*/
		INSERT
			INTO SUBCATEGORY(
				  TOPCATEGORY_ID
				, NAME
				, REGDATE
				, LAST_MODI_YMD
			)
			VALUES(
				  #{TOPCATEGORY_ID}
				, #{SUB_NM}
				, SYSDATE()
				, SYSDATE()
			)
	</insert>
	
	<insert id="alcoholReg" parameterType="map">
		/*주류 정보 등록, 이양원*/
		INSERT
			INTO ALCOHOL(
				  SUBCATEGORY_ID
				, NAME
				, DEGREE
				, DETAIL
				, REGDATE
				, LAST_MODI_YMD
			)
			VALUES(
				  #{SUBCATEGORY_ID}
				, #{ALCOHOL_NM}
				, #{ALC_DEGREE}
				, #{ALC_DETAIL}
				, SYSDATE()
				, SYSDATE()
			)	
	</insert>
	
	<select id="alcCountTopCate" resultType="int">
		/*총 게시물 수 조회*/
		SELECT   /*alcCountTopCate*/
				COUNT(1)
		FROM ALCOHOL A
	</select>
	
	<!-- 기존 알콜 리스트 조회 쿼리는 사용하지 않는다.(id = alcoholLst) -->
	<select id="alcoholLstIqrPager" resultType="Alcohol">
		/*알콜 및 상위, 하위 카테고리 전체 조회 + 페이징, 이양원*/
		SELECT   /*alcoholLstIqrPager*/
				XX.*
		  FROM (SELECT  
					     @ROWNUM:=@ROWNUM+1 AS NUM
					  ,  A.ALCOHOL_ID
					  , (SELECT TOPCATEGORY_ID FROM TOPCATEGORY WHERE 1=1 AND TOPCATEGORY_ID = B.TOPCATEGORY_ID) AS TOPCATEGORY_ID
					  , (SELECT NAME  FROM TOPCATEGORY WHERE 1=1 AND TOPCATEGORY_ID = B.TOPCATEGORY_ID) AS TOP_NM
					  , B.SUBCATEGORY_ID
					  , B.NAME AS SUB_NM
					  , A.NAME AS ALCOHOL_NM
					  , A.DEGREE AS ALC_DEGREE
					  , A.DETAIL AS ALC_DETAIL
					  , A.REGDATE
					  , A.LAST_MODI_YMD
				    FROM ALCOHOL A
						   , SUBCATEGORY B
						   , (SELECT @ROWNUM := 0) TMP
				    WHERE 1=1
					    AND A.SUBCATEGORY_ID = B.SUBCATEGORY_ID
				    ORDER BY ALCOHOL_ID) XX
		  WHERE 1=1
		      AND NUM BETWEEN #{start} AND #{end}
		  ORDER BY XX.ALCOHOL_ID DESC
	</select>
</mapper>